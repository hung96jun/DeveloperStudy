자가 균형 이진 트리(self-balancing binary seartch tree)로, 대표적으로는 연관 배열 등을 구현하는데 사용되는 자료구조. 구현에 있어서 복잡하지만 사용에서 효율적이고, 최악의 경우에도 O(logN)의 시간 복잡도로 삽입, 삭제, 검색을 할 수 있다.

- 용도
	자료의 삽입, 삭제, 검색에서 최악의 경우에도 일정한 실행 시간을 보장. 이는 실시간 처리와 같은 실행 시간이 중요한 경우 유용하게 사용될 뿐만 아니라, 일정한 실행 시간을 보장하는 또 다른 자료구조를 만드는 데에도 쓸모가 있다.(ex : 각종 기하학 계산에 사용되는 많은 자료구조들이 레드-블랙 트리를 기반으로 만들어져있다.)
	레드-블랙 트리는 함수형 프로그래밍에서 특히 유용하다. 함수형 프로그래밍에서 사용되는 연관 배열이나 집합(set) 등을 내부적으로 레드-블랙 트리로 구현해 놓은 경우가 많다.
	레드-블랙 트리는 2-3-4 트리와 등장변환이 가능하다.(isometry) 즉, 모든 2-3-4 트리에는 구성 원소와 그 순서(order)가 같은 레드-블랙 트리가 최소한 하나 이상 존재한다는 것이다. 2-3-4 트리에서의 삽입, 삭제 과정은 레드-블랙 트리에서의 색 전환(color-flipping)과 회전(rotation)과 같은 개념이다.
- 특성
	![[Pasted image 20231207051247.png]]
	레드-블랙 트리는 각각의 노드가 레드나 블랙인 색상 속성을 가지고 있는 이진 탐색 트리이다. 이진 탐색 트리가 가지고 있는 일반적인 조건에 다음과 같은 추가적 조건을 만족해야 유효한 레드-블랙 트리가 된다.
	1. 노드는 레드 혹은 블랙 중의 하나이다.
	2. 루트 노드는 브랙이다.
	3. 모든 리프 노드들은 블랙이다.
	4. 레드 노드의 자식 노드 양쪽은 언제나 모두 블랙이다.(즉, 레드 노드는 연달아 나타낼 수 없으며, 블랙 노드만이 레드 노드의 부모 노드가 될 수 있다, 또한 블랙 노드의 자식은 블랙일 수 있다.)
	5. 어떤 노드로부터 시작되어 그에 속한 하위 리프 노드에 도달하는 모든 경로에는 리프 노드를 제외하면 모두 같은 개수의 블랙 노드가 있다.
- 동작
	- rotation
		- 노드가 추가, 삭제 되었을 때 불균형 트리로 되게 되면 Rotation을 시켜 균형 트리로 다시 맞추어 주는 작업
		- Left-Left Rotation
			![[Pasted image 20231211135621.png]]
			- 단일 왼쪽 회전 동작
				- 편향 이진 트리가 됐을 경우 사용하여 밸런스를 유지하는 회전
		- Right-Right Rotation
			![[Pasted image 20231211162129.png]]
			- 단일 오른족 회전
				- 편향 이진 트리가 됐을 경우 사용하여 밸런스를 유지하는 회전
		- Left-Right Rotation
			![[Pasted image 20231211144255.png]]
			- 왼쪽 자식 노드의 오른족 자식 노드가 삽입될 때 동작. 하부 노드들 부터 왼쪽 회전 후, 상부 노드들끼리 오른쪽 회전을 하는 이중 회전 동작
		- Right-Left Rotation
			![[Pasted image 20231211144416.png]]
			- 오른쪽 자식 노드의 왼쪽 자식 노드가 삽입될 때 동작. 하부 노드들 부터 오른쪽 회전 후, 상부 노드들끼리 왼쪽 회전을 하는 이중 회전 동작
	- Restructuring
		- 
	- Insert
		- 새로운 노드는 항상 빨간색이다.
		- 하지만 이럴경우 Double Red 현상이 발생한다.
			- 삼촌 노드가 검은색일 경우 -> Restructing
				- 새로운 노드(N), 부모 노드(P), 조상 노드(G)를 오름차순으로 정렬
				- 셋 중 중간값을 부모로 만들고 나머지 둘을 자식으 로 만든다.
				- 새로 부모가 된 노드를 검은색으로 만들고 나머지 자식들을 빨간색으로 만든다.
				![[Pasted image 20231209052404.png]]
			- 삼촌 노드가 빨간색일 경우 -> Recoloring
				- 새로운 노드(N)의 부모(P)와 삼촌(U)를 검은색으로 바꾸고 조상(G)을 빨간색으로 바꾼다.
					- 조상(G)이 루트 노드라면 검은색으로 바꾼다.
					- 조상(G)을 빨간색으로 바꿨을 때 또다시 Double Red가 발생한다면 또 Restructing 혹은 ReColoring을 진행해서 Double Red 현상을 해결
				![[Pasted image 20231209052636.png]]
				![[Pasted image 20231209052641.png]]
				![[Pasted image 20231209052645.png]]
	- Delete
		- 이진 탐색 트리에서의 삭제 방법을 따라 노드 삭제 후 색상 조정
		- 삭제할 노드가 두 개의 자식 노드를 가지고 있을 경우
			- 오른쪽 서브 트리에서 최소 원소를 가진 노드의 값과 부모 노드의 값을 스왑 후 해당 노드 삭제
			- 자식 노드의 색상은 변경 없이 값만 변경 -> 레드 블랙 트리 특성에 영향을 끼치지 않는다.
		- 부모 노드를 삭제 후 부모 노드 주변 노드의 레드 블랙 특성 위반 여
		- 타겟 노드 다음으로 큰 값을 가진 노드와 스왑 후 스왑된 노드 삭제(이진 탐색 트리의 삭제 방식)

	- 동작
		1. 새 노드가 트리의 시작(root)에 위치한다. 이 경우, 레드-블랙 트리의 첫 번째 속성(트리의 시작은 검은색이다)를 만족하기 위해서, N을 검은색으로 표시. 이 경우, 시작점으로부터 뻗어나가는 모든 경로에 검은색 노드를 하나 추가한것이 되기 때문에 레드-블랙 트리의 다섯 번재 속성(한 노드에서부터 뻗어나가는 모든 경로에 대해 검은색 노드의 수는 같다.)은 유효하다.
		2. 새 노드의 부모 노드 P가 검은색이면, 레드-블랙 트리의 네 번째 속성(붉은색 노드의 모든 자식 노드는 검은색이다)은 유효하다. 그러므로 두 번째 경우에도 이 트리는 적절한 레드-블랙 트리이다. 레드-블랙 트리의 다섯 번째 속성(한 노드에서부터 뻗어나가는 모든 경로에 대해 검은색 노드의 수는 같다)도 문제 없은데, 이는 새로운 노드 N은 두 개의 검은색 노드를 leaf node로 가지고 있기 때문이다. 비록 N이 붉은색 노드라고 해도 N이 들어간 자리에 원래 위치했던 노드의 색이 검은색이었으므로, N의 자식 노드에게서 시작되는 경로들은 모두 같은 수의 검은색 노드를 가지게 되고, 결과적으로 다섯 번째 속성은 유지된다.
		3. 만약 부모 노드 P와 삼촌 노드 U가 모두 붉은색 노드라면, 레드-블랙 트리의 다섯 번째 속성(한 노드에서부터 뻗어나가는 모든 경로에 대해 검은색 노드의 수는 같다)을 유지하기 위해서, P와 U를 모두 검은색으로 바꾸고 할아버지 노드 G를 붉은색으로 바꾼다. 이렇게 함으로써 붉은색 노드인 N은 검은색 부모 노드를 가지게 된다. 그런데 이번에는 할아버지 노드 G가 레드 블랙 트리의 두 번째 속성(root node는 검은색이다)이나 네 번째 속성(붉은색 노드의 두 자식 노드는 검은색이다)을 만족하지 않을 수 있다.(네 번째 속성은 G의 부모 노드가 붉은색일 경우 만족하지 않는다) 이를 해결하기 위해서 G에 대해 지금까지 설명한 첫 번째 경우부터 세 번째 경우까지 재귀적으로(recursively) 적용한다. 이 작업은 삽입 과정 중에 발생하는 유일한 재귀 호출이며, 회전 작업을 하기 전에 적용해야 한다는 것에 주의한다.(이는 일정한 횟수의 회전 작업만이 필요하다는 것을 증명)
		4. 부모 노드 P가 붉은색인데, 삼촌 노드 U는 검은색이다. 또한 새로운 노드 N은 P의 오른쪽 자식 노드이며, P는 할아버지 노드 G의 왼쪽 자식 노드이다. 이 경우, N과 P의 역할을 변경하기 위해서 왼쪽 회전을 한다. 그 후, 부모 노드였던 P를 다섯 번째 경우에서 처리하게 되는데, 이는 레드-블랙 트리의 네 번째 속성(붉은색 노드의 모든 자식은 검은색 노드이다)을 아직 만족하지 않기 때문이다. 회전 작업은 몇몇 경로들이 이전에는 지나지 않았던 노드를 지나게 하는데, 그럼에도 양쪽 노드가 모두 붉은색이므로, 레드-블랙 트리의 다섯 번재 속성(한 노드에서부터 뻗어나가는 모든 경로에 대해 검은색 노드의 수는 같다)을 위반하지 않는다.
		5. 부모 노드 P는 붉은색이지만 삼촌 노드 U는 검은색이고, 새로운 노드 N이 P의 왼쪽 자식 노드이고, P가 할아버지 노드 G의 왼쪽 자식 노드인 상황에서는 G에 대해 오른쪽 회전을 한다. 회전의 결과 이전의 부모 노드였던 P는 새로운 노드 N과 할아버지 노드 G를 자식 노드로 갖는다. G가 이전에 검은색이었고, P는 붉은색일 수밖에 없기 때문에, P와 G의 색을 반대로 바꾸면 레드-블랙 트리의 네 번째 속성(붉은색 노드의 두 자식 노드는 검은색 노드이다)을 만족한다. 레드-블랙 트리의 다섯 번째 속성(한 노드에서부터 뻗어나가는 모든 경로에 대해 검은색 노드의 수는 같다)은 계속 유지되는데, 이는 이전에 P를 포함하는 경로는 모두 G를 지나게 되고, 바뀐 후 G를 포함하는 경로는 모두 P를 지나기 때문이다. 바뀌기 전에는 G가, 바뀐 후에는 P가 P, G, N중 유일한 검은색 노드이다.
	- 삭제
		- 두 개의 leaf 노드가 전부 null이 아닐 경우 - 타겟 노드를 삭제할 때, 타겟 노드 외쪽 서브트리에서 최댓값 또는 오른쪽 서브 트리에서 최솟값을 갖는 노드를 찾아서 해당 노드의 값을 타겟 노드의 값과 스왑하고 해당 노드를 삭제.
		- 
>[!tip] 삼촌 노드
>같은 높이에 있는 옆 노드의 부모 노드를 의미